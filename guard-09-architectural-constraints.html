<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architectural Constraints as Code &mdash; tmux for AI-Powered Development</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header>
    <div class="container">
      <p class="site-label">tmux + AI CLI</p>
      <h1><a href="index.html">tmux for AI-Powered Development</a></h1>
      <nav>
        <a href="index.html">Tracks</a>
        <span class="track-label">Guardrails for Speed</span>
      </nav>
    </div>
  </header>

  <main class="container">

    <!-- SLOGAN BANNER -->
    <div class="slogan-banner">
      <span class="main-slogan">See everything. Control everything.</span>
      <span class="subtext">Interactive tutorials for mastering tmux with Claude Code and Codex CLI.</span>
    </div>

    <!-- PAGE TITLE -->
    <h1 class="page-title">Architectural Constraints as Code</h1>

    <!-- LESSON METADATA -->
    <div class="course-meta">
      <span class="meta-pill">Lesson <strong>9</strong> of 10</span>
      <span class="meta-pill"><strong>Intermediate</strong></span>
      <span class="meta-pill">Track: Guardrails for Speed</span>
    </div>

    <!-- LEAD PARAGRAPH -->
    <p class="lead">A linter catches style problems. A compiler catches type errors. But what catches an AI agent that puts database logic directly in your API controller, violating your layered architecture? Architectural constraints encoded as automated tests catch structural violations that no other guardrail can see.</p>

    <!-- CONCEPT -->
    <h2>The Architecture Drift Problem</h2>

    <p>AI agents don&rsquo;t inherently understand your architecture. They see files and functions, not layers and boundaries.</p>

    <p>Without explicit constraints, an agent will take the shortest path: need database access? Import the ORM directly in the controller. Need a utility? Copy it instead of using the shared module.</p>

    <p>These shortcuts work. The code runs. The tests pass. But the architecture erodes with every shortcut.</p>

    <p>Over time, this creates &ldquo;architecture debt&rdquo;&mdash;the system works but becomes impossible to maintain or extend.</p>

    <div class="callout warning">
      <p><strong>Architecture drift is invisible to line-level guardrails.</strong> Your linter won&rsquo;t flag a correct import that violates a layer boundary. Your tests won&rsquo;t fail when a dependency arrow points the wrong way. You need a different kind of guardrail.</p>
    </div>

    <h2>Dependency Rules as Tests</h2>

    <p>Tools like ArchUnit (Java), ArchUnitNET (.NET), eslint-plugin-boundaries (TypeScript), and similar tools let you encode dependency rules as unit tests.</p>

    <p>These tests don&rsquo;t verify behavior&mdash;they verify structure. &ldquo;Module A should not import from Module B.&rdquo;</p>

    <p>Here is a conceptual example using a TypeScript/eslint style:</p>

    <div class="skill-file">
      <div class="skill-file-header">architectural-rules.test.ts</div>
      <div class="copy-wrapper">
        <button class="copy-btn">Copy</button>
        <pre>// architectural-rules.test.ts
// These tests verify structural constraints, not behavior

// Rule 1: API layer cannot import database modules directly
// api/*.ts should not import from db/*.ts

// Rule 2: Core business logic has no external dependencies
// core/*.ts should not import from api/*.ts or db/*.ts

// Rule 3: Shared utilities cannot import from feature modules
// shared/*.ts should not import from features/*.ts</pre>
      </div>
    </div>

    <p>For projects without dedicated architectural testing tools, a simpler bash approach works just as well:</p>

    <div class="skill-file">
      <div class="skill-file-header">check-dependencies.sh</div>
      <div class="copy-wrapper">
        <button class="copy-btn">Copy</button>
        <pre>#!/bin/bash
# check-dependencies.sh â€” lightweight architectural constraint checker

VIOLATIONS=0

# Rule: src/core/ should not import from src/db/
if grep -r "from.*['\"].*db/" src/core/ 2>/dev/null; then
  echo "VIOLATION: core/ imports from db/" &gt;&amp;2
  VIOLATIONS=$((VIOLATIONS + 1))
fi

# Rule: src/api/ should not import from src/core/internal/
if grep -r "from.*['\"].*core/internal" src/api/ 2>/dev/null; then
  echo "VIOLATION: api/ imports from core/internal/" &gt;&amp;2
  VIOLATIONS=$((VIOLATIONS + 1))
fi

if [ $VIOLATIONS -gt 0 ]; then
  echo "$VIOLATIONS architectural violation(s) found" &gt;&amp;2
  exit 2
fi

echo "Architecture: OK"
exit 0</pre>
      </div>
    </div>

    <h2>Diagrams for Understanding, Tests for Enforcement</h2>

    <p>Generating architecture diagrams from code is valuable&mdash;it helps you understand what the agent built.</p>

    <p>But diagrams are for humans. They require you to look at them and notice problems.</p>

    <p>Automated tests are for machines. They run in the agentic loop and catch violations immediately.</p>

    <div class="callout info">
      <p><strong>Use both.</strong> Generate diagrams when you need to understand. Run tests when you need to enforce. The diagram tells you what the architecture looks like. The test ensures it stays that way.</p>
    </div>

    <h2>Wiring Architecture Checks into the Loop</h2>

    <p>These checks can run as part of your test suite (triggered by PostToolUse hooks from <a href="guard-05-hooks-as-guardrails.html">Lesson 5</a>).</p>

    <p>Or as a standalone hook that runs periodically or on session Stop.</p>

    <p>They&rsquo;re lightweight&mdash;checking import statements is fast.</p>

    <p>They pair well with the quiet wrapper from <a href="guard-08-token-budget.html">Lesson 8</a>: &ldquo;Architecture: OK&rdquo; on success, specific violations on failure.</p>

    <!-- EXERCISE -->
    <h2>Exercise</h2>

    <div class="step-card">
      <span class="step-number">1</span>
      <span class="step-title">Sketch your intended architecture</span>
      <div class="step-content">
        <p>Sketch your project&rsquo;s intended architecture, even informally: &ldquo;controllers should not import database code.&rdquo; Write it down as a list of dependency rules.</p>
      </div>
    </div>

    <div class="step-card">
      <span class="step-number">2</span>
      <span class="step-title">Write dependency rules as a bash script</span>
      <div class="step-content">
        <p>Write 2&ndash;3 dependency rules as grep-based checks in a bash script, following the <code>check-dependencies.sh</code> pattern above.</p>
      </div>
    </div>

    <div class="step-card">
      <span class="step-number">3</span>
      <span class="step-title">Check for existing violations</span>
      <div class="step-content">
        <p>Run the script against your codebase. Do any violations already exist? If so, fix them or document them as known exceptions.</p>
      </div>
    </div>

    <div class="step-card">
      <span class="step-number">4</span>
      <span class="step-title">Wire it into a hook</span>
      <div class="step-content">
        <p>Wire the script into a PostToolUse hook or a Stop hook so it runs automatically during agentic sessions.</p>
      </div>
    </div>

    <div class="step-card">
      <span class="step-number">5</span>
      <span class="step-title">Test with an agent</span>
      <div class="step-content">
        <p>Run a Claude agent and verify: does it respect the boundaries? If it violates one, does the hook catch it?</p>
      </div>
    </div>

    <!-- CHECKPOINT -->
    <h2>Checkpoint</h2>

    <ul class="checklist">
      <li>Architecture drift is invisible to line-level guardrails</li>
      <li>Dependency rules can be encoded as automated tests or simple grep scripts</li>
      <li>Diagrams help you understand; tests help you enforce</li>
      <li>Architecture checks are lightweight and fit inside the agentic loop</li>
      <li>Without structural constraints, AI agents take the shortest path&mdash;which erodes your architecture</li>
    </ul>

    <!-- WHAT'S NEXT -->
    <div class="callout success">
      <p><strong>What&rsquo;s Next:</strong> In <a href="guard-10-building-your-pipeline.html">Lesson 10: Building Your Pipeline</a>, you&rsquo;ll compose all ten guardrails into a reusable pipeline that you can take to any project.</p>
    </div>

    <!-- DIVIDER -->
    <div class="divider"></div>

    <!-- PAGE NAVIGATION (Prev/Next) -->
    <nav class="page-nav">
      <a href="guard-08-token-budget.html" class="prev">Token Budget Engineering</a>
      <a href="guard-10-building-your-pipeline.html" class="next">Building Your Pipeline</a>
    </nav>

    <!-- BOTTOM SITE NAVIGATION (Track-grouped) -->
    <nav class="site-nav-bottom">
      <h3>All Lessons</h3>
      <ul>
        <!-- Getting Started -->
        <li class="nav-phase-label">Getting Started</li>
        <li><a href="setup.html">Setup &amp; Configuration</a></li>

        <!-- Track 1: tmux + Claude Code -->
        <li class="nav-phase-label">Beginner: tmux + Claude Code</li>
        <li><a href="claude-01-first-session.html">1. Your First Session</a></li>
        <li><a href="claude-02-detach-reattach.html">2. Detach &amp; Reattach</a></li>
        <li><a href="claude-03-split-panes.html">3. Split Panes</a></li>
        <li><a href="claude-04-launch-claude.html">4. Launch Claude Code</a></li>
        <li><a href="claude-05-supervisor-workflow.html">5. Supervisor Workflow</a></li>
        <li><a href="claude-06-windows.html">6. Windows</a></li>
        <li><a href="claude-07-background-tasks.html">7. Background Tasks</a></li>
        <li><a href="claude-08-copy-mode.html">8. Copy Mode</a></li>
        <li><a href="claude-09-headless-sessions.html">9. Headless Sessions</a></li>
        <li><a href="claude-10-putting-it-together.html">10. Putting It Together</a></li>

        <!-- Track 2: tmux + Codex CLI -->
        <li class="nav-phase-label">Beginner: tmux + Codex CLI</li>
        <li><a href="codex-01-first-session.html">1. Your First Session</a></li>
        <li><a href="codex-02-detach-reattach.html">2. Detach &amp; Reattach</a></li>
        <li><a href="codex-03-split-panes.html">3. Split Panes</a></li>
        <li><a href="codex-04-launch-codex.html">4. Launch Codex CLI</a></li>
        <li><a href="codex-05-supervisor-workflow.html">5. Supervisor Workflow</a></li>
        <li><a href="codex-06-windows.html">6. Windows</a></li>
        <li><a href="codex-07-multitasking.html">7. Multitasking</a></li>
        <li><a href="codex-08-copy-mode.html">8. Copy Mode</a></li>
        <li><a href="codex-09-headless-sessions.html">9. Headless Sessions</a></li>
        <li><a href="codex-10-putting-it-together.html">10. Putting It Together</a></li>

        <!-- Track 3: Multi-Agent Orchestration -->
        <li class="nav-phase-label">Advanced: Multi-Agent Orchestration</li>
        <li><a href="parallel-01-multi-session-architecture.html">1. Multi-Session Architecture</a></li>
        <li><a href="parallel-02-launching-agents.html">2. Launching the Agents</a></li>
        <li><a href="parallel-03-assigning-tasks.html">3. Assigning Tasks</a></li>
        <li><a href="parallel-04-control-dashboard.html">4. Control Dashboard</a></li>
        <li><a href="parallel-05-integration-point.html">5. Integration Point</a></li>
        <li><a href="parallel-06-synchronized-commands.html">6. Synchronized Commands</a></li>
        <li><a href="parallel-07-conflict-resolution.html">7. Conflict Resolution</a></li>
        <li><a href="parallel-08-session-scripts.html">8. Session Scripts</a></li>
        <li><a href="parallel-09-capture-review.html">9. Capture &amp; Review</a></li>
        <li><a href="parallel-10-complete-workflow.html">10. Complete Workflow</a></li>

        <!-- Track 4: Developer Toolkit -->
        <li class="nav-phase-label">Advanced: Developer Toolkit</li>
        <li><a href="dx-01-skeleton.html">1. The dx Skeleton</a></li>
        <li><a href="dx-02-choosing-ai.html">2. Choosing Your AI</a></li>
        <li><a href="dx-03-review-command.html">3. Review Command</a></li>
        <li><a href="dx-04-pr-command.html">4. PR Command</a></li>
        <li><a href="dx-05-explain-command.html">5. Explain Command</a></li>
        <li><a href="dx-06-test-command.html">6. Test Command</a></li>
        <li><a href="dx-07-standup-command.html">7. Standup Command</a></li>
        <li><a href="dx-08-popup-mode.html">8. Popup Mode</a></li>
        <li><a href="dx-09-background-watchers.html">9. Background Watchers</a></li>
        <li><a href="dx-10-installation.html">10. Installation</a></li>

        <!-- Track 5: Guardrails for Speed -->
        <li class="nav-phase-label">Intermediate: Guardrails for Speed</li>
        <li><a href="guard-01-autonomy-ladder.html">1. The Autonomy Ladder</a></li>
        <li><a href="guard-02-permission-tiers.html">2. Permission Tiers</a></li>
        <li><a href="guard-03-compiler-guardrail.html">3. The Compiler as Guardrail</a></li>
        <li><a href="guard-04-deterministic-tools.html">4. Deterministic Tools Over Prompts</a></li>
        <li><a href="guard-05-hooks-as-guardrails.html">5. Hooks as Guardrails</a></li>
        <li><a href="guard-06-test-automation.html">6. Test Automation That Guards</a></li>
        <li><a href="guard-07-shift-left.html">7. Shift Left</a></li>
        <li><a href="guard-08-token-budget.html">8. Token Budget Engineering</a></li>
        <li><a href="guard-09-architectural-constraints.html" class="current">9. Architectural Constraints as Code</a></li>
        <li><a href="guard-10-building-your-pipeline.html">10. Building Your Pipeline</a></li>
      </ul>
    </nav>

  </main>

  <footer>
    <p>tmux + AI CLI &mdash; <a href="https://github.com/buildLittleWorlds/tmux-fundamentals">GitHub Repository</a></p>
  </footer>

  <script src="copy-code.js"></script>

</body>
</html>
