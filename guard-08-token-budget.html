<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Token Budget Engineering &mdash; tmux for AI-Powered Development</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header>
    <div class="container">
      <p class="site-label">tmux + AI CLI</p>
      <h1><a href="index.html">tmux for AI-Powered Development</a></h1>
      <nav>
        <a href="index.html">Tracks</a>
        <span class="track-label">Guardrails for Speed</span>
      </nav>
    </div>
  </header>

  <main class="container">

    <!-- SLOGAN BANNER -->
    <div class="slogan-banner">
      <span class="main-slogan">See everything. Control everything.</span>
      <span class="subtext">Interactive tutorials for mastering tmux with Claude Code and Codex CLI.</span>
    </div>

    <!-- PAGE TITLE -->
    <h1 class="page-title">Token Budget Engineering</h1>

    <!-- LESSON METADATA -->
    <div class="course-meta">
      <span class="meta-pill">Lesson <strong>8</strong> of 10</span>
      <span class="meta-pill"><strong>Intermediate</strong></span>
      <span class="meta-pill">Track: Guardrails for Speed</span>
    </div>

    <!-- LEAD PARAGRAPH -->
    <p class="lead">Every guardrail you add to the agentic loop consumes context window tokens. A test suite that dumps 500 lines of passing results, a linter that reports &ldquo;all clean&rdquo; with verbose formatting, a compiler that logs every file it touches&mdash;these eat through your token budget without helping the agent. Token budget engineering is the art of giving the agent exactly the information it needs and nothing more.</p>

    <!-- THE SIGNAL-TO-NOISE PROBLEM -->
    <h2>The Signal-to-Noise Problem</h2>

    <p>When a test suite passes, the agent needs exactly one signal: &ldquo;tests pass.&rdquo; When a test fails, the agent needs: which test failed, what was expected, what happened, and the relevant stack trace. Most tools produce verbose output in both cases. Your job is to wrap them.</p>

    <table class="tool-table">
      <thead>
        <tr>
          <th>Tool Output</th>
          <th>Tokens (approx)</th>
          <th>Signal Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Full test suite pass (500 lines)</td>
          <td>~2000</td>
          <td>Zero&mdash;agent already knows it passed</td>
        </tr>
        <tr>
          <td>Quiet wrapper: &ldquo;All 47 tests passing&rdquo;</td>
          <td>~10</td>
          <td>Same signal, 200x fewer tokens</td>
        </tr>
        <tr>
          <td>Full test failure with logs</td>
          <td>~2000</td>
          <td>Moderate&mdash;much is noise</td>
        </tr>
        <tr>
          <td>Filtered failure: name + expected + actual</td>
          <td>~50</td>
          <td>High&mdash;exactly what agent needs</td>
        </tr>
      </tbody>
    </table>

    <!-- THE WRAPPER PATTERN -->
    <h2>The Wrapper Pattern</h2>

    <p>Every deterministic tool should have a wrapper that:</p>

    <ol>
      <li>Runs the tool</li>
      <li>Checks the exit code</li>
      <li>On success: emit a single-line summary</li>
      <li>On failure: emit only the relevant error information</li>
    </ol>

    <div class="skill-file">
      <div class="skill-file-header">tool-wrapper.sh &mdash; generic quiet wrapper</div>
      <div class="copy-wrapper">
        <button class="copy-btn">Copy</button>
        <pre>#!/bin/bash
# tool-wrapper.sh â€” generic quiet wrapper
TOOL_NAME="$1"
shift

OUTPUT=$("$@" 2>&amp;1)
EXIT=$?

if [ $EXIT -eq 0 ]; then
  echo "$TOOL_NAME: OK"
else
  echo "$TOOL_NAME: FAILED" &gt;&amp;2
  echo "$OUTPUT" | grep -A 2 -E '(FAIL|ERROR|Error:|error:)' &gt;&amp;2
  exit 2
fi</pre>
      </div>
    </div>

    <!-- CONTEXT WINDOW AS A SCARCE RESOURCE -->
    <h2>Context Window as a Scarce Resource</h2>

    <p>The context window is the agent&rsquo;s working memory. Every token used by tool output is a token not available for reasoning about the problem. This becomes critical in long agentic sessions or multi-step tasks where the agent makes many tool calls.</p>

    <p>Strategies for managing the budget:</p>

    <ol>
      <li><strong>Quiet wrappers</strong> (as above)</li>
      <li><strong>Diff-only checking</strong> (from <a href="guard-04-deterministic-tools.html">Lesson 4</a>)&mdash;less input = fewer tokens</li>
      <li><strong>Structured error output</strong>&mdash;parseable, not narrative</li>
      <li><strong>Avoid redundant information</strong>&mdash;don&rsquo;t show the same file content twice</li>
      <li><strong>Use <code>tail</code> and <code>head</code></strong> to limit output length in hook scripts</li>
    </ol>

    <!-- MEASURING YOUR TOKEN SPEND -->
    <h2>Measuring Your Token Spend</h2>

    <p>You can estimate token spend by looking at how much output your guardrails produce. A rough rule: 1 token &asymp; 4 characters of English text.</p>

    <ul>
      <li>If your test wrapper produces 200 characters on success and your agent makes 20 edits, that&rsquo;s ~1000 tokens for test feedback alone&mdash;manageable.</li>
      <li>If your raw test output is 50,000 characters per run &times; 20 runs, that&rsquo;s ~250,000 tokens&mdash;potentially exceeding your context window.</li>
    </ul>

    <!-- EXERCISE -->
    <h2>Exercise</h2>

    <div class="step-card">
      <span class="step-number">1</span>
      <span class="step-title">Count your raw test output</span>
      <div class="step-content">
        <p>Run your project&rsquo;s test suite and count the lines of output on a passing run:</p>
        <div class="copy-wrapper">
          <button class="copy-btn">Copy</button>
          <div class="terminal-block">npm test 2>&amp;1 | wc -l</div>
        </div>
      </div>
    </div>

    <div class="step-card">
      <span class="step-number">2</span>
      <span class="step-title">Write a quiet wrapper</span>
      <div class="step-content">
        <p>Write a wrapper script that reduces passing output to a single line. Use the generic wrapper template above as a starting point.</p>
      </div>
    </div>

    <div class="step-card">
      <span class="step-number">3</span>
      <span class="step-title">Compare the output</span>
      <div class="step-content">
        <p>Run the wrapper and compare: same signal, drastically fewer lines.</p>
      </div>
    </div>

    <div class="step-card">
      <span class="step-number">4</span>
      <span class="step-title">Wire it into a hook</span>
      <div class="step-content">
        <p>Wire the wrapper into a PostToolUse hook and run a Claude session.</p>
      </div>
    </div>

    <div class="step-card">
      <span class="step-number">5</span>
      <span class="step-title">Verify failure handling</span>
      <div class="step-content">
        <p>Check: does Claude still respond correctly to test failures with the reduced output?</p>
      </div>
    </div>

    <!-- CHECKPOINT -->
    <h2>Checkpoint</h2>

    <ul class="checklist">
      <li>Every guardrail in the agentic loop consumes context window tokens</li>
      <li>Quiet wrappers: single-line on success, filtered errors on failure</li>
      <li>The context window is a scarce resource&mdash;protect it</li>
      <li>Diff-only checking reduces both token spend and processing time</li>
      <li>Measure your token budget: rough estimate is 4 characters per token</li>
    </ul>

    <!-- WHAT'S NEXT -->
    <div class="callout success">
      <p><strong>What&rsquo;s Next:</strong> In <a href="guard-09-architectural-constraints.html">Lesson 9: Architectural Constraints as Code</a>, you&rsquo;ll go beyond line-level linting to enforce structural rules like dependency direction, layer boundaries, and module isolation as automated tests.</p>
    </div>

    <!-- DIVIDER -->
    <div class="divider"></div>

    <!-- PAGE NAVIGATION (Prev/Next) -->
    <nav class="page-nav">
      <a href="guard-07-shift-left.html" class="prev">Shift Left</a>
      <a href="guard-09-architectural-constraints.html" class="next">Architectural Constraints as Code</a>
    </nav>

    <!-- BOTTOM SITE NAVIGATION (Track-grouped) -->
    <nav class="site-nav-bottom">
      <h3>All Lessons</h3>
      <ul>
        <!-- Getting Started -->
        <li class="nav-phase-label">Getting Started</li>
        <li><a href="setup.html">Setup &amp; Configuration</a></li>

        <!-- Track 1: tmux + Claude Code -->
        <li class="nav-phase-label">Beginner: tmux + Claude Code</li>
        <li><a href="claude-01-first-session.html">1. Your First Session</a></li>
        <li><a href="claude-02-detach-reattach.html">2. Detach &amp; Reattach</a></li>
        <li><a href="claude-03-split-panes.html">3. Split Panes</a></li>
        <li><a href="claude-04-launch-claude.html">4. Launch Claude Code</a></li>
        <li><a href="claude-05-supervisor-workflow.html">5. Supervisor Workflow</a></li>
        <li><a href="claude-06-windows.html">6. Windows</a></li>
        <li><a href="claude-07-background-tasks.html">7. Background Tasks</a></li>
        <li><a href="claude-08-copy-mode.html">8. Copy Mode</a></li>
        <li><a href="claude-09-headless-sessions.html">9. Headless Sessions</a></li>
        <li><a href="claude-10-putting-it-together.html">10. Putting It Together</a></li>

        <!-- Track 2: tmux + Codex CLI -->
        <li class="nav-phase-label">Beginner: tmux + Codex CLI</li>
        <li><a href="codex-01-first-session.html">1. Your First Session</a></li>
        <li><a href="codex-02-detach-reattach.html">2. Detach &amp; Reattach</a></li>
        <li><a href="codex-03-split-panes.html">3. Split Panes</a></li>
        <li><a href="codex-04-launch-codex.html">4. Launch Codex CLI</a></li>
        <li><a href="codex-05-supervisor-workflow.html">5. Supervisor Workflow</a></li>
        <li><a href="codex-06-windows.html">6. Windows</a></li>
        <li><a href="codex-07-multitasking.html">7. Multitasking</a></li>
        <li><a href="codex-08-copy-mode.html">8. Copy Mode</a></li>
        <li><a href="codex-09-headless-sessions.html">9. Headless Sessions</a></li>
        <li><a href="codex-10-putting-it-together.html">10. Putting It Together</a></li>

        <!-- Track 3: Multi-Agent Orchestration -->
        <li class="nav-phase-label">Advanced: Multi-Agent Orchestration</li>
        <li><a href="parallel-01-multi-session-architecture.html">1. Multi-Session Architecture</a></li>
        <li><a href="parallel-02-launching-agents.html">2. Launching the Agents</a></li>
        <li><a href="parallel-03-assigning-tasks.html">3. Assigning Tasks</a></li>
        <li><a href="parallel-04-control-dashboard.html">4. Control Dashboard</a></li>
        <li><a href="parallel-05-integration-point.html">5. Integration Point</a></li>
        <li><a href="parallel-06-synchronized-commands.html">6. Synchronized Commands</a></li>
        <li><a href="parallel-07-conflict-resolution.html">7. Conflict Resolution</a></li>
        <li><a href="parallel-08-session-scripts.html">8. Session Scripts</a></li>
        <li><a href="parallel-09-capture-review.html">9. Capture &amp; Review</a></li>
        <li><a href="parallel-10-complete-workflow.html">10. Complete Workflow</a></li>

        <!-- Track 4: Developer Toolkit -->
        <li class="nav-phase-label">Advanced: Developer Toolkit</li>
        <li><a href="dx-01-skeleton.html">1. The dx Skeleton</a></li>
        <li><a href="dx-02-choosing-ai.html">2. Choosing Your AI</a></li>
        <li><a href="dx-03-review-command.html">3. Review Command</a></li>
        <li><a href="dx-04-pr-command.html">4. PR Command</a></li>
        <li><a href="dx-05-explain-command.html">5. Explain Command</a></li>
        <li><a href="dx-06-test-command.html">6. Test Command</a></li>
        <li><a href="dx-07-standup-command.html">7. Standup Command</a></li>
        <li><a href="dx-08-popup-mode.html">8. Popup Mode</a></li>
        <li><a href="dx-09-background-watchers.html">9. Background Watchers</a></li>
        <li><a href="dx-10-installation.html">10. Installation</a></li>

        <!-- Track 5: Guardrails for Speed -->
        <li class="nav-phase-label">Intermediate: Guardrails for Speed</li>
        <li><a href="guard-01-autonomy-ladder.html">1. The Autonomy Ladder</a></li>
        <li><a href="guard-02-permission-tiers.html">2. Permission Tiers</a></li>
        <li><a href="guard-03-compiler-guardrail.html">3. The Compiler as Guardrail</a></li>
        <li><a href="guard-04-deterministic-tools.html">4. Deterministic Tools Over Prompts</a></li>
        <li><a href="guard-05-hooks-as-guardrails.html">5. Hooks as Guardrails</a></li>
        <li><a href="guard-06-test-automation.html">6. Test Automation That Guards</a></li>
        <li><a href="guard-07-shift-left.html">7. Shift Left</a></li>
        <li><a href="guard-08-token-budget.html" class="current">8. Token Budget Engineering</a></li>
        <li><a href="guard-09-architectural-constraints.html">9. Architectural Constraints as Code</a></li>
        <li><a href="guard-10-building-your-pipeline.html">10. Building Your Pipeline</a></li>
      </ul>
    </nav>

  </main>

  <footer>
    <p>tmux + AI CLI &mdash; <a href="https://github.com/buildLittleWorlds/tmux-fundamentals">GitHub Repository</a></p>
  </footer>

  <script src="copy-code.js"></script>

</body>
</html>
